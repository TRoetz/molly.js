THREE.TrackballControls=function(e,t){function g(e){if(n.enabled===!1)return;window.removeEventListener("keydown",g),o=s;if(s!==r.NONE)return;e.keyCode===n.keys[r.ROTATE]&&!n.noRotate?s=r.ROTATE:e.keyCode===n.keys[r.ZOOM]&&!n.noZoom?s=r.ZOOM:e.keyCode===n.keys[r.PAN]&&!n.noPan&&(s=r.PAN)}function y(e){if(n.enabled===!1)return;s=o,window.addEventListener("keydown",g,!1)}function b(e){if(n.enabled===!1)return;e.preventDefault(),e.stopPropagation(),s===r.NONE&&(s=e.button),s===r.ROTATE&&!n.noRotate?a=f=n.getMouseProjectionOnBall(e.clientX,e.clientY):s===r.ZOOM&&!n.noZoom?l=c=n.getMouseOnScreen(e.clientX,e.clientY):s===r.PAN&&!n.noPan&&(d=v=n.getMouseOnScreen(e.clientX,e.clientY)),document.addEventListener("mousemove",w,!1),document.addEventListener("mouseup",E,!1)}function w(e){if(n.enabled===!1)return;e.preventDefault(),e.stopPropagation(),s===r.ROTATE&&!n.noRotate?f=n.getMouseProjectionOnBall(e.clientX,e.clientY):s===r.ZOOM&&!n.noZoom?c=n.getMouseOnScreen(e.clientX,e.clientY):s===r.PAN&&!n.noPan&&(v=n.getMouseOnScreen(e.clientX,e.clientY))}function E(e){if(n.enabled===!1)return;e.preventDefault(),e.stopPropagation(),s=r.NONE,document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",E)}function S(e){if(n.enabled===!1)return;e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),l.y+=1/t*.05}function x(e){if(n.enabled===!1)return;switch(e.touches.length){case 1:s=r.TOUCH_ROTATE,a=f=n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:s=r.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;p=h=Math.sqrt(t*t+i*i);break;case 3:s=r.TOUCH_PAN,d=v=n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:s=r.NONE}}function T(e){if(n.enabled===!1)return;e.preventDefault(),e.stopPropagation();switch(e.touches.length){case 1:f=n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;p=Math.sqrt(t*t+i*i);break;case 3:v=n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:s=r.NONE}}function N(e){if(n.enabled===!1)return;switch(e.touches.length){case 1:a=f=n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:h=p=0;break;case 3:d=v=n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)}s=r.NONE}THREE.EventDispatcher.call(this);var n=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=e,this.domElement=t!==undefined?t:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=Infinity,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=new THREE.Vector3,s=r.NONE,o=r.NONE,u=new THREE.Vector3,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector2,c=new THREE.Vector2,h=0,p=0,d=new THREE.Vector2,v=new THREE.Vector2,m={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(e){typeof this[e.type]=="function"&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-n.screen.offsetLeft)/n.radius*.5,(t-n.screen.offsetTop)/n.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var r=new THREE.Vector3((e-n.screen.width*.5-n.screen.offsetLeft)/n.radius,(n.screen.height*.5+n.screen.offsetTop-t)/n.radius,0),i=r.length();i>1?r.normalize():r.z=Math.sqrt(1-i*i),u.copy(n.object.position).sub(n.target);var s=n.object.up.clone().setLength(r.y);return s.add(n.object.up.clone().cross(u).setLength(r.x)),s.add(u.setLength(r.z)),s},this.rotateCamera=function(){var e=Math.acos(a.dot(f)/a.length()/f.length());if(e){var t=(new THREE.Vector3).crossVectors(a,f).normalize(),r=new THREE.Quaternion;e*=n.rotateSpeed,r.setFromAxisAngle(t,-e),u.applyQuaternion(r),n.object.up.applyQuaternion(r),f.applyQuaternion(r),n.staticMoving?a.copy(f):(r.setFromAxisAngle(t,e*(n.dynamicDampingFactor-1)),a.applyQuaternion(r))}},this.zoomCamera=function(){if(s===r.TOUCH_ZOOM){var e=h/p;h=p,u.multiplyScalar(e)}else{var e=1+(c.y-l.y)*n.zoomSpeed;e!==1&&e>0&&(u.multiplyScalar(e),n.staticMoving?l.copy(c):l.y+=(c.y-l.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var e=v.clone().sub(d);if(e.lengthSq()){e.multiplyScalar(u.length()*n.panSpeed);var t=u.clone().cross(n.object.up).setLength(e.x);t.add(n.object.up.clone().setLength(e.y)),n.object.position.add(t),n.target.add(t),n.staticMoving?d=v:d.add(e.subVectors(v,d).multiplyScalar(n.dynamicDampingFactor))}},this.checkDistances=function(){if(!n.noZoom||!n.noPan)n.object.position.lengthSq()>n.maxDistance*n.maxDistance&&n.object.position.setLength(n.maxDistance),u.lengthSq()<n.minDistance*n.minDistance&&n.object.position.addVectors(n.target,u.setLength(n.minDistance))},this.update=function(){u.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,u),n.checkDistances(),n.object.lookAt(n.target),i.distanceToSquared(n.object.position)>0&&(n.dispatchEvent(m),i.copy(n.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",b,!1),this.domElement.addEventListener("mousewheel",S,!1),this.domElement.addEventListener("DOMMouseScroll",S,!1),this.domElement.addEventListener("touchstart",x,!1),this.domElement.addEventListener("touchend",N,!1),this.domElement.addEventListener("touchmove",T,!1),window.addEventListener("keydown",g,!1),window.addEventListener("keyup",y,!1),this.handleResize()};